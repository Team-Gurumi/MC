



| 파일 | 설명 |
| :-- | :-- |
| `go.mod`, `go.sum` | Go 모듈 의존성 관리 파일 |
| `run_*.sh` | 실험 및 벤치마크 실행용 셸 스크립트 (`run_experiments1.sh`, `run_fault_tolerance_benchmark.sh` 등) |
| `analyze_metrics.py` | 실험 결과 분석용 Python 스크립트 |
| `agent`, `control`, `seeder` | `cmd/` 폴더의 소스가 컴파일된 실행 바이너리 파일 |

---

## **`cmd/` — 실행 진입점 (Main Applications)**

프로젝트의 **메인 실행 프로그램 진입점**이 들어있는 폴더이다.  
각 하위 폴더가 개별 실행 파일이다.

| 폴더 | 역할 |
| :-- | :-- |
| `cmd/agent/` | 에이전트(Agent) 노드의 실행 진입점 — 작업 실행·상태 관리 담당 |
| `cmd/control/` | 컨트롤(Control) 서버 실행 진입점 — 중앙 관리 및 API 서버 |
| `cmd/seeder/` | 시더(Seeder) 노드 실행 진입점 — P2P로 입력 파일 전송 |
| `cmd/dhtget/` | DHT 네트워크에서 데이터를 가져오는 유틸리티 도구(디버킹용) |

---

## **`pkg/` — 공통 라이브러리 (Core Packages)**

모든 실행 모듈(`cmd/...`)에서 공통으로 사용하는 **핵심 기능 패키지**들이 위치한다.

| 폴더 | 역할 |
| :-- | :-- |
| `pkg/agent/` | 에이전트 로직: 작업 실행, 상태 보고, 리스(Lease) 관리 |
| `pkg/dht/` | 분산 해시 테이블(DHT) 노드 및 XOR 라우팅 로직 |
| `pkg/p2p/` | 피어 간 P2P 통신 프로토콜 구현 |
| `pkg/task/` | 작업(Task) 데이터 구조 및 리스·자원 점유 관련 로직 |
| `pkg/demand/` | PostgreSQL 기반 작업(Job) 저장 및 관리 로직 |
| `pkg/seeder/` | 시더(Seeder) 요청 처리 및 데이터 분배 로직 |

---

#서버에 Go, Docker, systemd 는 이미 설치되어 있어야 함

#설치
# 컨트롤 서버 설치(원격)
make install-control HOST=ubuntu@control-box PORT=8080 TIMEOUT=180

# 에이전트 설치(원격) - 컨트롤 서버 주소 넘김(로컬/테일스케일 IP)
make install-agent  HOST=ubuntu@node-1 CONTROL_URL=http://100.70.1.2:8080
# 작업 지정할 노드 (에이전트) - 같은 컨트롤에 붙이고 kata 사용
make install-agent  HOST=ubuntu@B CONTROL_URL=http://100.70.1.2:8080 DOCKER_RUNTIME=kata-runtime

# 이후 재시작/로그
make agent-restart  HOST=ubuntu@node-1
make logs-agent     HOST=ubuntu@node-1

# 작업 처리할 agent의 NODE_ID 확인
ssh ubuntu@B 'hostname'      # 예: "node-b"
# 또는
ssh ubuntu@B 'systemctl show -p Environment mc-agent'

# 사용자가 작업 push (target_node 지정)
curl -X POST http://100.70.1.2:8080/api/tasks/push \
  -H 'Content-Type: application/json' \
  -d '{
    "image": "alpine:3.20",
    "cmd": ["sh","-c","echo hi-from-A && sleep 2 && uname -a"],
    "timeout_sec": 60,
    "labels": {
      "job": "demo",
      "target_node": "node-b"
    },
    "resources": {
      "nano_cpus": 500000000,
      "memory_bytes": 268435456
    }
  }'

# 결과 확인
curl http://<control-host>:8080/api/tasks
curl http://<control-host>:8080/api/tasks/<taskId>
